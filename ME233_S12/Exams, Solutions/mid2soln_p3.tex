\section*{Problem 3}

\begin{enumerate}
    \item
    If we define $X_f(z) = Q_f(z) X(z)$ where $X(z)$ and $X_f(z)$ are respectively the Z-transforms of $x(k)$ and $x_f(k)$, the power spectral density of $x_f(k)$ is given by
    \begin{align*}
        \Phi_{X_f X_f}(\omega) = Q_f(e^{j\omega}) \Phi_{XX}(\omega) Q_f^*(e^{j\omega})
    \end{align*}
    This allows us to rewrite the cost function as
    \begin{align*}
        J & = \operatorname{trace} \left[ \frac{1}{2\pi} \int_{-\pi}^\pi 
            \left( \Phi_{X_f X_f}(\omega) + \rho \Phi_{UU}(\omega) \right) d\omega \right] \\
        & = \operatorname{trace} \left[ \frac{1}{2\pi} \int_{-\pi}^\pi \Phi_{X_f X_f}(\omega) d\omega 
            + \rho \frac{1}{2\pi} \int_{-\pi}^\pi \Phi_{UU}(\omega) d\omega \right] \\
        & = \operatorname{trace} \left[ E\{x_f(k) x_f^T(k) + \rho E \{ u(k) u^T(k) \} \right] \\
        & = E \left\{ \operatorname{trace} [ x_f(k) x_f^T(k) + \rho u(k) u^T(k)] \right\} \\
        & = E \{ x_f^T(k) x_f(k) + \rho u^T(k) u(k) \}
    \end{align*}
    
    \item
    We first define the extended state $x_e(k) = [x^T(k) \ x_f^T(k)]^T$ so that the system and cost function dynamics can be written
    \begin{align}
        x_e(k+1) & = A_e x_e(k) + B_e u(k) + B_{we} w(k)
            \label{eq:m2p3_syse1} \\
        y(k) & = C_e x_e(k) + v(k)
            \label{eq:m2p3_syse2}
    \end{align}
    where
    \begin{align*}
        A_e & = \begin{bmatrix}
                A & 0 \\
                B_f & A_f
            \end{bmatrix}
            & B_e & = \begin{bmatrix}
                B \\
                0
            \end{bmatrix}
            & B_{we} & = \begin{bmatrix}
                B_w \\
                0
            \end{bmatrix}
            & C_e & = \begin{bmatrix}
                C & 0
            \end{bmatrix}
    \end{align*}
    We then define
    \begin{align*}
        Q & = \begin{bmatrix}
                D_f^T \\
                C_f^T
            \end{bmatrix} \begin{bmatrix}
                D_f & C_f
            \end{bmatrix} 
            & R & = \rho I
    \end{align*}
    so that the cost function can be written as
    \begin{align}
        J = E \{ x_e^T(k) Qx_e(k) + u^T(k) Ru(k) \}
            \label{eq:m2p3_coste}
    \end{align}
    
    \item
    Finding the output feedback control that minimizes \eqref{eq:m2p3_coste} subject to \eqref{eq:m2p3_syse1}--\eqref{eq:m2p3_syse2} is a standard infinite-horizon output feedback LQG optimal control problem. The solution is therefore given by
    \begin{align*}
        u^o(k) & = -K \hat{x}_e(k)
    \end{align*}
    where $K$ is the standard deterministic LQR gain given by
    \begin{align*}
        & K = (B_e^T P B_e + R)^{-1} B_e^T P A_e \\
        & P = A_e^T P A_e + Q - A_e^T P B_e ( B_e^T P B_e + R)^{-1} B_e^T P A_e \\
        & \textrm{such that } A_e - B_e K \textrm{ is Schur}
    \end{align*}
    and $\hat{x}_e(k)$ is the a posteriori state estimate generated by the stationary Kalman filter
    \begin{align*}
        \hat{x}_e(k) & = \hat{x}_e^o(k) + F [y(k) - C_e \hat{x}^o(k)] \\
        \hat{x}_e^o(k+1) & = A_e \hat{x}_e(k) + B_e u(k)
    \end{align*}
    where
    \begin{align*}
        & F = M C_e^T (C_e M C_e^T + V)^{-1} \\
        & M = A_e M A_e^T + B_{we} W B_{we}^T - A_e M C_e^T (C_e M C_e^T + V)^{-1} C_e M A_e^T \\
        & \textrm{such that } A_e - A_e F C_e \textrm{ is Schur}
    \end{align*}
    
\end{enumerate} 